from .types import RitualContext

def _anchor_line(ctx: RitualContext) -> str:
    m = ctx.market
    if m is None or m.price is None or m.change_24h_pct is None or m.volume_24h is None:
        return f"{ctx.chat_token}: data unavailable"
    sign = "â–²" if m.change_24h_pct >= 0 else "â–¼"
    return f"{ctx.chat_token}: {m.price:.4f} {sign}{m.change_24h_pct:.2f}% Â· 24h vol {m.volume_24h:,.0f}"

# --- STUB CONTENT: minimal but production-safe ---
def template_pre_roll(ctx: RitualContext) -> str:
    anchor = _anchor_line(ctx)
    return (
        f"â³ Pre-Roll | {ctx.hub.name} | {ctx.ritual_dt_iso}\n"
        f"{anchor}\n"
        "Navigator warm-up: breathe, prep, set intention ğŸŒŠğŸŒ¿"
    )

def template_holy_minute(ctx: RitualContext) -> str:
    anchor = _anchor_line(ctx)
    return (
        f"ğŸ”¥ Holy Minute | {ctx.hub.name} | {ctx.ritual_dt_iso}\n"
        f"{anchor}\n"
        "â€œO le ala i le pule o le tautua.â€ Service first. We are Bongterm ğŸŒ±"
    )
